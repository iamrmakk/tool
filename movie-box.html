<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MovieBox â€” Telegram Mini App</title>

  <!-- Monetag meta for verification -->
  <meta name="monetag" content="11a8d4a9aef2714708fde2a7545c6859">

  <!-- Telegram Web App SDK (optional, useful when opened inside Telegram) -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* small clean styling */
    body { -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    .card-thumb { aspect-ratio: 16/9; object-fit: cover; background: #111; display:block; }
    .no-thumb { background: linear-gradient(90deg,#111,#333); height:100%; width:100%; color:#fff; display:flex; align-items:center; justify-content:center; font-weight:600; }
    .glass { background: rgba(255,255,255,0.6); backdrop-filter: blur(6px); }
  </style>
</head>

<!-- Monetag script placed right below the head tag as requested -->
<script src='//libtl.com/sdk.js' data-zone='9768747' data-sdk='show_9768747'></script>

<body class="bg-gray-100 min-h-screen flex flex-col">

  <header class="bg-white shadow p-4">
    <div class="max-w-4xl mx-auto flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-bold">ðŸŽ¬ MovieBox</h1>
        <p class="text-sm text-gray-500">Owner-managed movie library â€” Hindi & English</p>
      </div>
      <div class="text-sm text-gray-600">Owner uploads directly to server</div>
    </div>
  </header>

  <!-- Ad slot (Monetag) -->
  <div class="max-w-4xl mx-auto p-4">
    <div id="monetag-ad" class="w-full h-20 bg-gray-200 rounded-lg flex items-center justify-center text-gray-600">Ad</div>
  </div>

  <!-- Tabs -->
  <nav class="max-w-4xl mx-auto px-4">
    <div class="bg-white rounded-xl flex overflow-hidden border">
      <button id="tab-hindi" class="flex-1 py-3 text-center font-medium text-blue-600">Hindi</button>
      <button id="tab-english" class="flex-1 py-3 text-center font-medium">English</button>
    </div>
  </nav>

  <!-- Movies grid -->
  <main class="max-w-4xl mx-auto p-4 flex-1 w-full">
    <div id="loading" class="text-center text-gray-500 py-8">Loading moviesâ€¦</div>
    <div id="grid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>
    <div id="empty" class="text-center text-gray-500 mt-8 hidden">No movies available yet.</div>
  </main>

  <!-- Player modal -->
  <div id="playerModal" class="fixed inset-0 hidden items-center justify-center bg-black bg-opacity-70 z-40">
    <div class="w-full max-w-3xl bg-black rounded overflow-hidden">
      <div class="flex items-center justify-between p-3 bg-gray-900 text-white">
        <div id="playerTitle" class="font-semibold">Playing</div>
        <button id="closePlayer" class="text-gray-200">âœ•</button>
      </div>
      <video id="player" controls class="w-full" playsinline webkit-playsinline></video>
    </div>
  </div>

  <footer class="max-w-4xl mx-auto p-4 text-center text-sm text-gray-500">Â© MovieBox</footer>

<script>
  const API = '/api/movies';
  const grid = document.getElementById('grid');
  const loading = document.getElementById('loading');
  const empty = document.getElementById('empty');
  const tabHindi = document.getElementById('tab-hindi');
  const tabEnglish = document.getElementById('tab-english');
  const playerModal = document.getElementById('playerModal');
  const player = document.getElementById('player');
  const playerTitle = document.getElementById('playerTitle');
  const closePlayer = document.getElementById('closePlayer');

  let state = { lang: 'hindi', movies: { hindi: [], english: [] } };

  async function loadMovies(){
    loading.style.display = 'block';
    try {
      const res = await fetch(API);
      const json = await res.json();
      if (!json.ok) throw new Error('API error');
      state.movies.hindi = json.hindi || [];
      state.movies.english = json.english || [];
      render();
    } catch (err) {
      console.error(err);
      loading.textContent = 'Failed to load movies';
    } finally {
      loading.style.display = 'none';
    }
  }

  function render(){
    const list = state.movies[state.lang] || [];
    grid.innerHTML = '';
    if (!list.length) {
      empty.classList.remove('hidden');
      return;
    } else {
      empty.classList.add('hidden');
    }

    list.forEach(m => {
      const card = document.createElement('div');
      card.className = 'bg-white rounded-xl overflow-hidden shadow';
      const thumbHTML = m.thumb
        ? `<img src="${m.thumb}" alt="${escapeHtml(m.title)}" class="card-thumb w-full block">`
        : `<div class="card-thumb no-thumb">${escapeHtml(m.title)}</div>`;

      card.innerHTML = `
        <div class="relative">
          ${thumbHTML}
        </div>
        <div class="p-3">
          <div class="font-semibold text-sm truncate">${escapeHtml(m.title)}</div>
          <div class="mt-3 flex gap-2">
            <button class="watchBtn bg-blue-600 text-white px-3 py-1 rounded text-sm" data-src="${m.url}" data-title="${escapeHtml(m.title)}">Watch</button>
            <a class="bg-gray-100 px-3 py-1 rounded text-sm" href="${m.url}" target="_blank" rel="noopener">Open</a>
          </div>
        </div>
      `;
      grid.appendChild(card);
    });

    // attach handlers
    document.querySelectorAll('.watchBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const src = btn.dataset.src;
        const title = btn.dataset.title;
        openPlayer(src, title);
      });
    });
  }

  function openPlayer(src, title){
    player.pause();
    player.src = src;
    playerTitle.textContent = title;
    playerModal.classList.remove('hidden');
    playerModal.style.display = 'flex';
    player.play().catch(()=>{});
  }

  closePlayer.addEventListener('click', () => {
    player.pause();
    player.src = '';
    playerModal.classList.add('hidden');
  });

  // Tabs
  tabHindi.addEventListener('click', () => { state.lang='hindi'; tabHindi.classList.add('text-blue-600'); tabEnglish.classList.remove('text-blue-600'); render(); });
  tabEnglish.addEventListener('click', () => { state.lang='english'; tabEnglish.classList.add('text-blue-600'); tabHindi.classList.remove('text-blue-600'); render(); });

  function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'})[c]); }

  // initial load
  loadMovies();

  // Optional: periodically refresh (so newly dropped files appear)
  setInterval(loadMovies, 30_000); // every 30s (adjust if you like)
</script>

</body>
</html>
